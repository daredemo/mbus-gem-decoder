\hypertarget{mbusdecode_8py_source}{}\doxysubsection{mbusdecode.\+py}
\label{mbusdecode_8py_source}\index{mbus\_gem\_decoder/mbusdecode.py@{mbus\_gem\_decoder/mbusdecode.py}}
\mbox{\hyperlink{mbusdecode_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00001}\mbox{\hyperlink{namespacembus__gem__decoder_1_1mbusdecode}{00001}} \textcolor{stringliteral}{"{}"{}"{}MBUS-\/GEM}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00002}00002 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00003}00003 \textcolor{stringliteral}{Package for decoding MBUS-\/GEM register data into JSON format, optionally in}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00004}00004 \textcolor{stringliteral}{more verbose human-\/readable values. The decoder takes a list of ten integers}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00005}00005 \textcolor{stringliteral}{and converts it to a JSON object based on the object type:}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00006}00006 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00007}00007 \textcolor{stringliteral}{*MBUS-\/GEM (gateway)}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00008}00008 \textcolor{stringliteral}{*METER}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00009}00009 \textcolor{stringliteral}{*METER ENTRY}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00010}00010 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00011}00011 \textcolor{stringliteral}{Author: René}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00012}00012 \textcolor{stringliteral}{Version: 0.1.0}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00013}00013 \textcolor{stringliteral}{Copyright: GPLv3}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00014}00014 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00015}00015 \textcolor{stringliteral}{Date: 2022-\/11-\/8}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00016}00016 \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00019}00019 \_\_version\_\_ = \textcolor{stringliteral}{"{}0.1.0"{}}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00020}00020 \_\_author\_\_ = \textcolor{stringliteral}{"{}René"{}}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00022}00022 \textcolor{keyword}{from} . \textcolor{keyword}{import} RegisterType, REGISTER\_TYPES\_ARRAY, READABILITY\_TYPES\_ARRAY}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00023}00023 \textcolor{keyword}{from} . \textcolor{keyword}{import} MBusMeter, MBusMeterEntry, MBusMBus}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00026}00026 \textcolor{keyword}{class }\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode}{MBusDecode}}:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00027}00027     \textcolor{stringliteral}{"{}"{}"{}MBUS-\/GEM class for decoding data from MBUS-\/GEM gateway's registers.}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00028}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode}{00028}} \textcolor{stringliteral}{    "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00029}00029 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00030}00030 \textcolor{stringliteral}{    }\textcolor{keyword}{def }\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_abbfc60ad0dc3cd56cb33396a59638e2d}{\_\_init\_\_}}(}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00031}00031                  self,}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00032}00032                  ten\_regs: list[int],}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00033}00033                  gw\_reg: int,}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00034}00034                  human: int = 0) -\/> \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00035}00035         \textcolor{stringliteral}{"{}"{}"{}Constructor}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00036}00036 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00037}00037 \textcolor{stringliteral}{        Args:}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00038}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_abbfc60ad0dc3cd56cb33396a59638e2d}{00038}} \textcolor{stringliteral}{            ten\_regs (list[int]): Ten register values }\textcolor{keyword}{as} list of integers.}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00039}00039             gw\_reg (int): Register \textcolor{keyword}{as} declared \textcolor{keywordflow}{in} the MBUS-\/GEM gateway.}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00040}00040             human (int, optional): Generate human readable values: 0 -\/-\/ ignore,}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00041}00041             1 -\/-\/ only human readable values, 2 -\/-\/ both. Defaults to 0.}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00042}00042         \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00043}00043 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00044}00044 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} gw\_reg < 0:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00045}00045             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"{}Gateway register cannot be negative"{}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00046}00046         \textcolor{keywordflow}{if} len(ten\_regs) != 10:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00047}00047             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"{}Must provide exactly ten register values"{}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00048}00048         \textcolor{comment}{\# if human not in [0, 1, 2]:}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00049}00049         \textcolor{keywordflow}{if} human \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} READABILITY\_TYPES\_ARRAY:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00050}00050             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"{}Illegal value for human readability"{}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00051}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_ab56e55eab097f4be34b0f90119132576}{00051}}         self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_ab56e55eab097f4be34b0f90119132576}{ten\_regs}} = ten\_regs}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00052}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a99a342293dce8614cd55d7de5df69177}{00052}}         self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a99a342293dce8614cd55d7de5df69177}{gw\_reg}} = gw\_reg}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00053}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a65f6524081c4296e063538026f6f55ff}{00053}}         self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a65f6524081c4296e063538026f6f55ff}{human}} = human}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00054}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{00054}}         self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}} = \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00055}00055         reg\_type = abs(self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_ab56e55eab097f4be34b0f90119132576}{ten\_regs}}[7] >> 8)}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00056}00056         \textcolor{keywordflow}{if} reg\_type \textcolor{keywordflow}{in} REGISTER\_TYPES\_ARRAY:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00057}00057             \textcolor{keywordflow}{if} reg\_type == RegisterType.METER\_ENTRY.value:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00058}00058                 self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}} = MBusMeterEntry(}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00059}00059                     self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_ab56e55eab097f4be34b0f90119132576}{ten\_regs}}, self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a99a342293dce8614cd55d7de5df69177}{gw\_reg}}, self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a65f6524081c4296e063538026f6f55ff}{human}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00060}00060             \textcolor{keywordflow}{elif} reg\_type == RegisterType.METER.value:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00061}00061                 self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}} = MBusMeter(}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00062}00062                     self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_ab56e55eab097f4be34b0f90119132576}{ten\_regs}}, self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a99a342293dce8614cd55d7de5df69177}{gw\_reg}}, self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a65f6524081c4296e063538026f6f55ff}{human}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00063}00063             \textcolor{keywordflow}{elif} reg\_type == RegisterType.MBUS\_GEM.value:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00064}00064                 self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}} = MBusMBus(}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00065}00065                     self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_ab56e55eab097f4be34b0f90119132576}{ten\_regs}}, self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a99a342293dce8614cd55d7de5df69177}{gw\_reg}}, self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a65f6524081c4296e063538026f6f55ff}{human}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00066}00066             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00067}00067                 \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"{}Illegal register type"{}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00068}00068         \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00069}00069             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"{}Illegal register type"{}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00071}00071             \textcolor{comment}{\# self.conversion = switch\_.get(}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00072}00072             \textcolor{comment}{\#     RegisterType(abs(self.ten\_regs[7] >> 8)), \{\})}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00074}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_abca2a656549fe154e56b238e8e1dcfc0}{00074}}     \textcolor{keyword}{def }\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_abca2a656549fe154e56b238e8e1dcfc0}{\_\_str\_\_}}(self) -\/> str:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00075}00075         \textcolor{keywordflow}{if} isinstance(self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}}, type(\textcolor{keywordtype}{None})):}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00076}00076             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"{}Conversion failed"{}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00077}00077         \textcolor{keywordflow}{return} str(self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00079}00079     \textcolor{keyword}{def }\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a4625b31833b680c840f4cd2379b8c862}{to\_object}}(self) -\/> object:}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00080}00080         \textcolor{stringliteral}{"{}"{}"{}Convert class to object}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00081}00081 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00082}00082 \textcolor{stringliteral}{        Raises:}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00083}00083 \textcolor{stringliteral}{            Exception: Conversion has failed}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00084}00084 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00085}00085 \textcolor{stringliteral}{        Returns:}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00086}00086 \textcolor{stringliteral}{            object: Converted object}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00087}\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a4625b31833b680c840f4cd2379b8c862}{00087}} \textcolor{stringliteral}{        "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00088}00088 \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00089}00089 \textcolor{stringliteral}{        }\textcolor{keywordflow}{if} isinstance(self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}}, type(\textcolor{keywordtype}{None})):}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00090}00090             \textcolor{keywordflow}{raise} Exception(\textcolor{stringliteral}{"{}Conversion failed"{}})}
\DoxyCodeLine{\Hypertarget{mbusdecode_8py_source_l00091}00091         \textcolor{keywordflow}{return} self.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_aefa17b3b334ff3be81c2fe2118e62508}{conversion}}.\mbox{\hyperlink{classmbus__gem__decoder_1_1mbusdecode_1_1MBusDecode_a4625b31833b680c840f4cd2379b8c862}{to\_object}}()}

\end{DoxyCode}
